<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AniHix: <!-- Filename --></title>

    <link rel="icon" href="https://homies-theta.vercel.app/logo.png">
    <link rel="shortcut icon" href="https://homies-theta.vercel.app/logo.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Theme -->
    <link rel="stylesheet" href="https://bootswatch.com/5/<!-- Theme -->/bootstrap.min.css">

    <!-- Video.js -->
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet">

    <!-- IMA Ads -->
    <link href="https://cdn.jsdelivr.net/npm/videojs-ima@1.9.1/dist/videojs.ima.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
    <style>
        body {
            margin: 0;
        }
        .video-container {
            max-width: 900px;
            margin: 20px auto;
            aspect-ratio: 16/9;
        }
        .video-js {
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg bg-primary p-2" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <img src="https://homies-theta.vercel.app/logo.png" height="40">
            </a>

            <form id="logoutForm" action="/logout" method="post">
                <button type="submit" class="btn btn-secondary btn-sm">
                    <i class="bi bi-box-arrow-left"></i> Logout
                </button>
            </form>
        </div>
    </nav>

    <!-- VIDEO PLAYER -->
    <div class="video-container">
        <video id="player" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto"
            data-setup='{"fluid": true}' poster="<!-- Poster -->">
            <source src="#" type="video/mp4">
        </video>
    </div>

    <!-- File Card -->
    <div class="card bg-light mb-3" style="max-width:600px;margin:auto;border-radius:5px;">
        <div class="card-body">
            <h6>Name: <!-- Filename --></h6>
            <p>Size: <!-- Size --></p>
        </div>
    </div>

    <!-- BUTTONS -->
    <div class="container d-flex justify-content-center gap-2 mb-3">
        <button onclick="mx_player()" class="btn btn-primary">MX Player</button>
        <button onclick="vlc_player()" class="btn btn-primary">VLC</button>
        <button onclick="km_player()" class="btn btn-primary">KM Player</button>
        <button onclick="download_file()" class="btn btn-primary">Download</button>
        <button onclick="open_tg()" class="btn btn-primary">Get File</button>
    </div>

    <!-- FOOTER -->
    <footer class="footer text-center py-3 text-muted">
        <p>
            Made with ❤️ by <a href="https://t.me/Uchiha_Developer" target="_blank">Sasuke Uchiha</a><br>
            © 2025 <a href="#" target="_blank">AniHix</a>. All Rights Reserved.
        </p>
    </footer>

    <!-- SCRIPTS -->
    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
    <script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-contrib-ads@6.9.0/dist/videojs-contrib-ads.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.9.1/dist/videojs.ima.min.js"></script>

<script>
/*-----------------------------------------
    URL & Download Link Builder
------------------------------------------*/

const fullUrl = window.location.href;
const urlObj = new URL(fullUrl);
const domain = urlObj.origin;

const videoId = urlObj.pathname.split("/").pop();
const idParam = urlObj.searchParams.get("id");
const hashParam = urlObj.searchParams.get("hash");

const encodedName = encodeURIComponent("<!-- Filename -->");

const downloadLink = `${domain}/${videoId}/${encodedName}?id=${idParam}&hash=${hashParam}`;

/*-----------------------------------------
    VIDEO.JS PLAYER + ADS
------------------------------------------*/

document.addEventListener("DOMContentLoaded", function () {

    const player = videojs("player");

    player.src({
        src: downloadLink,
        type: "application/x-mpegURL"
    });

    // If MP4 — fallback
    player.on("error", () => {
        player.src({ src: downloadLink, type: "video/mp4" });
        player.play();
    });

    // Initialize Ads
    player.ima({
        id: "player",
        adTagUrl: "https://active-bat.com/dkm/F/z.dkGKNhvLZmGEUd/OeSm-9kuQZrUwlSkJPSTqYR1RMvj/Qm4sNijTcltiNPj/U/y/N/DRgd2VONC_ZGsmamW/1wpzd/DA0cxP",
    });

    player.ready(() => {
        player.ima.initializeAdDisplayContainer();
        player.ima.requestAds();
        player.play();

        player.on("aderror", () => player.play());

        // MID-ROLL
        player.on("pause", () => {
            if (!player.ima.adIsPlaying()) {
                player.ima.changeAdTag("YOUR_MID_ROLL_VAST_URL");
                player.ima.requestAds();
            }
        });

        // POST-ROLL
        player.on("ended", () => {
            player.ima.changeAdTag("YOUR_POST_ROLL_VAST_URL");
            player.ima.requestAds();
        });
    });
});

/*-----------------------------------------
    Streaming Buttons (MX / VLC / KM)
------------------------------------------*/

function mx_player() {
    window.location.href = `intent:${downloadLink}#Intent;package=com.mxtech.videoplayer.ad;end`;
}

function vlc_player() {
    window.location.href = `vlc://${downloadLink}`;
}

function km_player() {
    window.location.href = `intent:${downloadLink}#Intent;package=com.kmplayer;end`;
}

function download_file() {
    window.location.href = downloadLink;
}

/*-----------------------------------------
    Open File in Telegram Bot
------------------------------------------*/
function open_tg() {
    // Example URL format: /12345?id=678&hash=
    const match = fullUrl.match(/\/(\d+)\?id=(\d+)/);

    if (!match) return alert("Unable to extract Chat ID.");

    const chatId = "-100" + match[1];
    const msgId = match[2];

    const botUsername = "<!-- Username -->";

    window.location.href = `https://t.me/${botUsername}?start=file_${msgId}${chatId}`;
}
</script>

</body>
</html>
